gini_hosp_donor <- read.delim(here("00_raw_data/08_hospital_donor/SCFA_taxonomy_analysis", "gini_hosp_donor.tsv"))
menhinick_hosp_donor <- read.delim(here("00_raw_data/08_hospital_donor/SCFA_taxonomy_analysis", "menhinick_hosp_donor.tsv"))
strong_hosp_donor <- read.delim(here("00_raw_data/08_hospital_donor/SCFA_taxonomy_analysis", "strong_hosp_donor.tsv"))
faith_hosp_donor <- read.delim(here("00_raw_data/08_hospital_donor/SCFA_taxonomy_analysis", "faith_hosp_donor.tsv"))
pielou_hosp_donor <- read.delim(here("00_raw_data/08_hospital_donor/SCFA_taxonomy_analysis", "pielou_hosp_donor.tsv"))
all_hosp_donor_alpha <- list(shannon_hosp_donor, chao1_hosp_donor, fisher_hosp_donor, margalef_hosp_donor, gini_hosp_donor, menhinick_hosp_donor, strong_hosp_donor, simpson_hosp_donor, faith_hosp_donor, pielou_hosp_donor)
all_hosp_donor_alpha <- all_hosp_donor_alpha %>% reduce(inner_join, by="X")
names(all_hosp_donor_alpha)[names(all_hosp_donor_alpha) == 'X'] <- 'sample_id'
#------------------------------
SCFA_alpha_donors <- SCFA_donors %>% left_join(all_hosp_donor_alpha, by=c('sample_id' = 'sample_id'))
#Delete problematic sample
SCFA_alpha_donors <- SCFA_alpha_donors %>%  filter(donor_donation != 'SMP48F_2nd')
head(SCFA_alpha_donors)
+++++++
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(phyloseq)
library(qiime2R)
library(microbiome)
library(microbiomeutilities)
library(tidyr)
library(data.table)
library(corrplot)
library(flextable)
# Creating phyloseq object
physeq <- qza_to_phyloseq(
features= "~/Desktop/master_project/Data_Hospital_donors/R2960/SCFA_QIIME2_analysis/table-dada2.qza",
tree= "~/Desktop/master_project/Data_Hospital_donors/R2960/SCFA_QIIME2_analysis/rooted-tree.qza",
taxonomy= "~/Desktop/master_project/Data_Hospital_donors/R2960/SCFA_QIIME2_analysis/taxonomy.qza",
metadata = "~/Desktop/master_project/Master-Project-Natasa-Mortvanski/01_tidy_data/SCFA_alpha_donors.tsv"
)
# physeq@sam_data
# sample_data(physeq)
# tax_glom function merges species that have the same taxonomy at a certain
# taxonomic rank - in this case family level
glom <- tax_glom(physeq, taxrank=rank_names(physeq)[5])
# psmelt function melts phyloseq data object into large data.frame
smelted_data <- psmelt(glom)
abundances_fam <- smelted_data %>% select(-c(Kingdom, Phylum, Class, Order)) %>%
spread(Family, Abundance) %>%
group_by(Sample) %>%
summarize(across(3:63, ~unique(na.omit(.x))),.groups = 'drop')
abundances_fam
# Save results as data frame
tax_alpha_cor <- as.data.frame(cor(abundances_fam[, c(6:15)], abundances_fam[,c(16:50)]))
tax_alpha_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_tax_alpha <- cor(abundances_fam[, c(6:15)], abundances_fam[,c(16:50)] , method = "spearman")
corrplot(matrix_tax_alpha, method="circle", tl.col = "black", tl.srt = 90,  col.lim = c(0,1), is.corr = FALSE)
# Save results as data frame
tax_alpha_cor <- as.data.frame(cor(abundances_fam[, c(6:15)], abundances_fam[,c(16:50)]))
tax_alpha_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_tax_alpha <- cor(abundances_fam[, c(6:15)], abundances_fam[,c(16:50)] , method = "spearman")
corrplot(matrix_tax_alpha, method="circle", tl.col = "black", tl.srt = 90,  col.lim = c(-1,1), is.corr = FALSE)
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(phyloseq)
library(qiime2R)
library(microbiome)
library(microbiomeutilities)
library(tidyr)
library(data.table)
library(corrplot)
library(flextable)
# Creating phyloseq object
physeq <- qza_to_phyloseq(
features= "~/Desktop/master_project/Data_Hospital_donors/R2960/SCFA_QIIME2_analysis/table-dada2.qza",
tree= "~/Desktop/master_project/Data_Hospital_donors/R2960/SCFA_QIIME2_analysis/rooted-tree.qza",
taxonomy= "~/Desktop/master_project/Data_Hospital_donors/R2960/SCFA_QIIME2_analysis/taxonomy.qza",
metadata = "~/Desktop/master_project/Master-Project-Natasa-Mortvanski/01_tidy_data/SCFA_alpha_donors.tsv"
)
# physeq@sam_data
# sample_data(physeq)
# tax_glom function merges species that have the same taxonomy at a certain
# taxonomic rank - in this case family level
glom <- tax_glom(physeq, taxrank=rank_names(physeq)[5])
# psmelt function melts phyloseq data object into large data.frame
smelted_data <- psmelt(glom)
abundances_fam <- smelted_data %>% select(-c(Kingdom, Phylum, Class, Order)) %>%
spread(Family, Abundance) %>%
group_by(Sample) %>%
summarize(across(3:63, ~unique(na.omit(.x))),.groups = 'drop')
abundances_fam
# Save results as data frame
tax_alpha_cor <- as.data.frame(cor(abundances_fam[, c(6:15)], abundances_fam[,c(16:50)]))
tax_alpha_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_tax_alpha <- cor(abundances_fam[, c(6:15)], abundances_fam[,c(16:50)] , method = "spearman")
corrplot(matrix_tax_alpha, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
# Save results as data frame
tax_SCFA_cor <- as.data.frame(cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)]))
tax_SCFA_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_tax_SCFA <- cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)] , method = "spearman")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
# Save results as data frame
alpha_SCFA_cor <- as.data.frame(cor(abundances_fam[, c(3:5)], abundances_fam[,c(6:15)]))
alpha_SCFA_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_alpha_SCFA <- cor(abundances_fam[, c(3:5)], abundances_fam[,c(6:15)] , method = "spearman")
corrplot(matrix_alpha_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
matrix_all <- cor(abundances_fam[, c(3:15)], abundances_fam[,c(16:50)] , method = "spearman")
corrplot(matrix_all, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
# tax_glom function merges species that have the same taxonomy at a certain
# taxonomic rank - in this case genus level
glom <- tax_glom(physeq, taxrank=rank_names(physeq)[6])
# psmelt function melts phyloseq data object into large data.frame
smelted_data <- psmelt(glom)
# Problem with Clostridium!
abundances_gen <- smelted_data %>% select(-c(Kingdom, Phylum, Class, Order, Family)) %>%
spread(Genus, Abundance) %>%
group_by(Sample) %>% select(-c(Clostridium)) %>%
summarize(across(2:94, ~unique(na.omit(.x))),.groups = 'drop')
abundances_gen
# Save results as data frame
tax_alpha_cor <- as.data.frame(cor(abundances_gen[, c(7:16)], abundances_gen[,c(17:94)]))
tax_alpha_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_tax_alpha_1 <- cor(abundances_gen[, c(7:16)], abundances_gen[,c(17:55)] , method = "spearman")
corrplot(matrix_tax_alpha_1, method="circle", tl.col = "black", tl.srt = 90, tl.cex =0.9, col.lim = c(-1,1), is.corr = FALSE)
matrix_tax_alpha_2 <- cor(abundances_gen[, c(7:16)], abundances_gen[,c(56:94)] , method = "spearman")
corrplot(matrix_tax_alpha_2, method="circle", tl.col = "black", tl.srt = 90, tl.cex =0.9, col.lim = c(-1,1), is.corr = FALSE)
# Save results as data frame
tax_SCFA_cor <- as.data.frame(cor(abundances_gen[, c(4:6)], abundances_gen[,c(17:94)]))
tax_SCFA_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_tax_SCFA_1 <- cor(abundances_gen[, c(4:6)], abundances_gen[,c(17:55)] , method = "spearman")
corrplot(matrix_tax_SCFA_1, method="circle", tl.col = "black", tl.srt = 90, tl.cex =0.9, col.lim = c(-1,1), is.corr = FALSE)
matrix_tax_SCFA_2 <- cor(abundances_gen[, c(4:6)], abundances_gen[,c(56:94)] , method = "spearman")
corrplot(matrix_tax_SCFA_2, method="circle", tl.col = "black", tl.srt = 90, tl.cex =0.9, col.lim = c(-1,1), is.corr = FALSE)
matrix_all_1 <- cor(abundances_gen[, c(4:16)], abundances_gen[,c(17:55)] , method = "spearman")
corrplot(matrix_all_1, method="circle", tl.col = "black", tl.srt = 90, tl.cex =0.9, col.lim = c(-1,1), is.corr = FALSE)
matrix_all_2 <- cor(abundances_gen[, c(4:16)], abundances_gen[,c(56:94)] , method = "spearman")
corrplot(matrix_all_2, method="circle", tl.col = "black", tl.srt = 90, tl.cex =0.9, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = TRUE)
# Save results as data frame
tax_SCFA_cor <- as.data.frame(cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)]))
tax_SCFA_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_tax_SCFA <- cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)] , method = "spearman")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE) + colorlegend(xlim=c(10,15), ylim=c(10,15), scalebluered, c(seq(-1,1,.25)), align="l", vertical=TRUE, addlabels=TRUE)
colorlegend(c(-1, 0, 1), align="l", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
colorlegend(c(-1, 0, 1), align="l", vertical=TRUE, addlabels=TRUE)
colorlegend(xlim=c(10,15), ylim=c(10,15), c(-1, 0, 1), align="l", vertical=TRUE, addlabels=TRUE)
colorlegend(xlim=c(10,15), ylim=c(10,15), c(-1, 0, 1), align="l", vertical=TRUE, addlabels=TRUE)
colorlegend(labels = c(-1, 0, 1), align="l", vertical=TRUE, addlabels=TRUE)
#colorlegend(labels = c(-1, 0, 1), align="l", vertical=TRUE, addlabels=TRUE)
colorlegend(rainbow(100),labels = c(-1, 0, 1))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), labels = c(-1, 0, 1), is.corr = FALSE)
# Save results as data frame
tax_SCFA_cor <- as.data.frame(cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)]))
tax_SCFA_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_tax_SCFA <- cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)] , method = "spearman")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
# Save results as data frame
tax_SCFA_cor <- as.data.frame(cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)]))
tax_SCFA_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_tax_SCFA <- cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)] , method = "spearman")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
colorlegend(xlim=c(10,15), ylim=c(10,15), scalebluered, c(seq(-1,1,.25)), align="l", vertical=TRUE, addlabels=TRUE)
colorlegend(xlim=c(10,15), ylim=c(10,15), c(seq(-1,1,.25)), align="l", vertical=TRUE, addlabels=TRUE)
# Save results as data frame
alpha_SCFA_cor <- as.data.frame(cor(abundances_fam[, c(3:5)], abundances_fam[,c(6:15)]))
alpha_SCFA_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_alpha_SCFA <- cor(abundances_fam[, c(3:5)], abundances_fam[,c(6:15)] , method = "spearman")
corrplot(matrix_alpha_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
colorlegend(xlim=c(10,15), ylim=c(10,15), labels = c(seq(-1,1,.25)), align="l", vertical=TRUE, addlabels=TRUE)
scalebluered <- colorRampPalette(brewer.pal(8, "RdBu"))(8)
library(dichromat)
scalebluered <- colorRampPalette(brewer.pal(8, "RdBu"))(8)
library(RColorBrewer)
scalebluered <- colorRampPalette(brewer.pal(8, "RdBu"))(8)
colorlegend(xlim=c(10,15), ylim=c(10,15), scalebluered, c(seq(-1,1,.25)), align="l", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
scalebluered <- colorRampPalette(brewer.pal(8, "RdBu"))(8)
colorlegend(xlim=c(10,15), ylim=c(10,15), scalebluered, c(seq(-1,1,.25)), align="l", vertical=TRUE, addlabels=TRUE)
colorlegend(xlim=c(10,15), ylim=c(10,15), scalebluered, c(seq(-1,1,.5)), align="l", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
scalebluered <- colorRampPalette(brewer.pal(8, "RdBu"))(8)
colorlegend(xlim=c(10,15), ylim=c(10,15), scalebluered, c(seq(-1,1,.5)), align="l", vertical=TRUE, addlabels=TRUE)
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
scalebluered <- colorRampPalette(brewer.pal(8, "RdBu"))(8)
colorlegend(xlim=c(10,15), ylim=c(10,15), scalebluered, c(seq(-1,1,.5)), align="l", vertical=TRUE, addlabels=TRUE)
colorlegend(xlim=c(10,15), ylim=c(10,15), scalebluered, c(seq(-1,1,.5)), align="r", vertical=TRUE, addlabels=TRUE)
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n") +
colorlegend(xlim=c(10,15), ylim=c(10,15), scalebluered, c(seq(-1,1,.5)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
colorlegend(xlim=c(10,15), ylim=c(10,15), scalebluered, c(seq(-1,1,.5)), align="r", vertical=TRUE, addlabels=TRUE)
colorlegend(xlim=c(10,15), ylim=c(10,15), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
colorlegend(xlim=c(10,15), ylim=c(10,15), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
colorlegend(xlim=c(10,12), ylim=c(10,15), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
colorlegend(xlim=c(10,13), ylim=c(10,15), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
colorlegend(xlim=c(20,23), ylim=c(10,15), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
colorlegend(xlim=c(35,38), ylim=c(10,15), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
colorlegend(xlim=c(35,38), ylim=c(10,15), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
colorlegend(xlim=c(35,38), ylim=c(10,15), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
colorlegend(xlim=c(35,38), ylim=c(10,15), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
colorlegend(xlim=c(37,40), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", ylim=c(0,35))
colorlegend(xlim=c(37,40), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", ylim=c(0,35))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", xlim=c(0,35))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(5, 4, 4, 2))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(0, 4, 4, 2))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(5, 4, 4, 2))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(0, 4, 4, 2))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(5, 1, 4, 5))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(5, 0, 4, 5))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 4, 5))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 5))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 5))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4))
colorlegend(xlim=c(37,40), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4))
colorlegend(xlim=c(37,40), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4))
colorlegend(xlim=c(30,35), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4))
colorlegend(xlim=c(33,35), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4))
colorlegend(xlim=c(40,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4)+ 0.1)
colorlegend(xlim=c(40,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4)+ 2)
colorlegend(xlim=c(40,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4)+ 2)
colorlegend(xlim=c(35,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4)+ 5)
colorlegend(xlim=c(35,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4))
colorlegend(xlim=c(35,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mai = c(1, 1, 1, 1.5))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mai = c(1, 1, 1, 1.5))
colorlegend(xlim=c(35,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mai = c(1, 1, 1, 1.5))
colorlegend(xlim=c(35,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4))
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mai = c(1, 1, 1, 1.5))
colorlegend(xlim=c(35,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4))
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mai = c(1, 1, 1, 1.5))
colorlegend(xlim=c(30,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mai = c(1, 1, 1, 1.5))
colorlegend(xlim=c(30,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mai = c(1, 1, 1, 1.5))
colorlegend(xlim=c(38,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mai = c(1, 1, 1, 1.5))
colorlegend(xlim=c(35,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
matrix_tax_SCFA <- cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)] , method = "spearman")
# corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mai = c(1, 1, 1, 1.5))
colorlegend(xlim=c(35,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
matrix_tax_SCFA <- cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)] , method = "spearman")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mai = c(1, 1, 1, 1.5))
colorlegend(xlim=c(35,43), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mai = c(1, 1, 1, 1.5))
colorlegend(xlim=c(30,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mai = c(1, 1, 1, 1.5))
colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mai = c(1, 1, 1, 1.5))
colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method = "circle", tl.col = "black", tl.srt = 90, cl.pos = "n")
# Add color legend
colorlegend(xlim = c(35, 38), ylim = c(5, 0), legend = c(seq(-1, 1, 1)),
align = "r", vertical = TRUE, addlabels = TRUE)
corrplot(matrix_tax_SCFA, method = "circle", tl.col = "black", tl.srt = 90, cl.pos = "n")
# Add color legend
colorlegend(xlim = c(35, 38), ylim = c(5, 0), scalebluered, legend = c(seq(-1, 1, 1)),
align = "r", vertical = TRUE, addlabels = TRUE)
corrplot(matrix_tax_SCFA, method = "circle", tl.col = "black", tl.srt = 90, cl.pos = "n")
# Add color legend
colorlegend(xlim = c(35, 38), ylim = c(5, 0), scalebluered, labels = c(seq(-1, 1, 1)),
align = "r", vertical = TRUE, addlabels = TRUE)
layout(matrix(c(1, 2), nrow = 1, ncol = 2, widths = c(1, 0.2)))
library(graphics)
layout(matrix(c(1, 2), nrow = 1, ncol = 2, widths = c(1, 0.2)))
layout( matrix(c(1,2), ncol=2) )
# Create the correlation plot
corrplot(matrix_tax_SCFA, method = "circle", tl.col = "black", tl.srt = 90, cl.pos = "n")
# Add color legend
colorlegend(xlim = c(35, 38), ylim = c(5, 0), labels = c(seq(-1, 1, 1)),
align = "r", vertical = TRUE, addlabels = TRUE)
layout( matrix(c(1,2), ncol=2) )
# Create the correlation plot
corrplot(matrix_tax_SCFA, method = "circle", tl.col = "black", tl.srt = 90, cl.pos = "n")
# Add color legend
colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
par(mar = c(5, 4, 4, 6) + 0.1)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
par(mfrow=c(2,1))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
par(mfrow=c(1,2))
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
#colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
legend("right", inset=.02, title= FALSE, c(seq(-1,1,1)), fill=topo.colors(3), vertical=TRUE, cex=0.8)
colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
#colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
legend("right", inset=.02, title= FALSE, c(seq(-1,1,1)), fill=topo.colors(3), horiz=FALSE, cex=0.8)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
#colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
legend("right", inset=.02, title= FALSE, c(seq(-1,1,1)), fill=topo.colors(3), horiz=FALSE, cex=0.8)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
#colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
legend("right", matrix_tax_SCFA, inset=.02, title= FALSE, c(seq(-1,1,1)), fill=topo.colors(3), horiz=FALSE, cex=0.8)
corrplot(matrix_tax_SCFA, method = "circle", tl.col = "black", tl.srt = 90, cl.pos = "n", mar = c(4, 0, 3, 4.5))
# Set up legend parameters
legend_x <- par("usr")[2] + 0.2
legend_y <- seq(-1, 1, length.out = 100)
legend_col <- scalebluered(legend_y)
corrplot(matrix_tax_SCFA, method = "circle", tl.col = "black", tl.srt = 90, cl.pos = "n", mar = c(4, 0, 3, 4.5))
# Set up legend parameters
legend_x <- par("usr")[2] + 0.1
legend_y <- seq(-1, 1, length.out = 100)
legend_col <- colorRampPalette(c("blue", "white", "red"))(length(legend_y))
# Add legend to the right side
legend("right", legend = legend_y, fill = legend_col, bty = "n", title = "Legend")
legend <- colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
plot <- corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5)) + legend
plot <- corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5)) + legend
plot <- corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
legend <- colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
plot + legend
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5)) +colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5)) + colorlegend(xlim=c(35,38), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
colorlegend(xlim=c(5,7), ylim=c(5,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
colorlegend(xlim=c(0,3), ylim=c(0,0), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
colorlegend(xlim=c(0,3), ylim=c(15,5), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
colorlegend(xlim=c(-1,2), ylim=c(15,8), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
colorlegend(xlim=c(-5,-3), ylim=c(15,8), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
colorlegend(xlim=c(-3,0), ylim=c(13,5), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
scalebluered <- colorRampPalette(brewer.pal(8, "RdBu"))(20)
# Plot correlation
matrix_tax_SCFA <- cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)] , method = "spearman")
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
colorlegend(xlim=c(-3,0), ylim=c(13,5), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
scalebluered <- colorRampPalette(brewer.pal(8, "RdBu"))(50)
# Plot correlation
matrix_tax_SCFA <- cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)] , method = "spearman")
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
colorlegend(xlim=c(-3,0), ylim=c(13,5), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
scalebluered <- colorRampPalette(brewer.pal(8, "RdBu"))(50)
# Plot correlation
matrix_tax_SCFA <- cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)] , method = "spearman")
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
colorlegend(xlim=c(-3,0), ylim=c(10,5), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
# Plot correlation
matrix_tax_SCFA <- cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)] , method = "spearman")
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", mar=c(4, 0, 3, 4.5))
colorlegend(xlim=c(-3,0), ylim=c(10,5), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
colorlegend(xlim=c(-3,0), ylim=c(10,5), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
matrix_tax_SCFA_1 <- cor(abundances_gen[, c(4:6)], abundances_gen[,c(17:55)] , method = "spearman")
corrplot(matrix_tax_SCFA_1, method="circle", tl.col = "black", tl.srt = 90, tl.cex =0.9, col.lim = c(-1,1), cl.pos="n", is.corr = FALSE)
colorlegend(xlim=c(-3,0), ylim=c(10,5), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
corrplot(matrix_tax_SCFA_1, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", is.corr = FALSE)
colorlegend(xlim=c(-3,0), ylim=c(10,5), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
matrix_tax_SCFA_2 <- cor(abundances_gen[, c(4:6)], abundances_gen[,c(56:94)] , method = "spearman")
corrplot(matrix_tax_SCFA_2, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", is.corr = FALSE)
colorlegend(xlim=c(-3,0), ylim=c(10,5), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(phyloseq)
library(qiime2R)
library(microbiome)
library(microbiomeutilities)
library(tidyr)
library(data.table)
library(corrplot)
library(flextable)
# Creating phyloseq object
physeq <- qza_to_phyloseq(
features= "~/Desktop/master_project/Data_Hospital_donors/R2960/SCFA_QIIME2_analysis/table-dada2.qza",
tree= "~/Desktop/master_project/Data_Hospital_donors/R2960/SCFA_QIIME2_analysis/rooted-tree.qza",
taxonomy= "~/Desktop/master_project/Data_Hospital_donors/R2960/SCFA_QIIME2_analysis/taxonomy.qza",
metadata = "~/Desktop/master_project/Master-Project-Natasa-Mortvanski/01_tidy_data/SCFA_alpha_donors.tsv"
)
# physeq@sam_data
# sample_data(physeq)
# tax_glom function merges species that have the same taxonomy at a certain
# taxonomic rank - in this case family level
glom <- tax_glom(physeq, taxrank=rank_names(physeq)[5])
# psmelt function melts phyloseq data object into large data.frame
smelted_data <- psmelt(glom)
abundances_fam <- smelted_data %>% select(-c(Kingdom, Phylum, Class, Order)) %>%
spread(Family, Abundance) %>%
group_by(Sample) %>%
summarize(across(3:63, ~unique(na.omit(.x))),.groups = 'drop')
abundances_fam
# Save results as data frame
tax_alpha_cor <- as.data.frame(cor(abundances_fam[, c(6:15)], abundances_fam[,c(16:50)]))
tax_alpha_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_tax_alpha <- cor(abundances_fam[, c(6:15)], abundances_fam[,c(16:50)] , method = "spearman")
corrplot(matrix_tax_alpha, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
library(dichromat)
library(RColorBrewer)
library(graphics)
# Save results as data frame
tax_SCFA_cor <- as.data.frame(cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)]))
tax_SCFA_cor %>% tibble::rownames_to_column() %>% flextable()
scalebluered <- colorRampPalette(brewer.pal(8, "RdBu"))(50)
# Plot correlation
matrix_tax_SCFA <- cor(abundances_fam[, c(3:5)], abundances_fam[,c(16:50)] , method = "spearman")
#corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
# I did not like how the generic legend looked like, so I decided to generate legend separately. However,
# I did not know how to put it on right side of the plot to look like the other plots, so I put it on the left side...
corrplot(matrix_tax_SCFA, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n")
colorlegend(xlim=c(-3,0), ylim=c(10,5), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
# Save results as data frame
alpha_SCFA_cor <- as.data.frame(cor(abundances_fam[, c(3:5)], abundances_fam[,c(6:15)]))
alpha_SCFA_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_alpha_SCFA <- cor(abundances_fam[, c(3:5)], abundances_fam[,c(6:15)] , method = "spearman")
corrplot(matrix_alpha_SCFA, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
matrix_all <- cor(abundances_fam[, c(3:15)], abundances_fam[,c(16:50)] , method = "spearman")
corrplot(matrix_all, method="circle", tl.col = "black", tl.srt = 90, col.lim = c(-1,1), is.corr = FALSE)
# tax_glom function merges species that have the same taxonomy at a certain
# taxonomic rank - in this case genus level
glom <- tax_glom(physeq, taxrank=rank_names(physeq)[6])
# psmelt function melts phyloseq data object into large data.frame
smelted_data <- psmelt(glom)
# Problem with Clostridium!
abundances_gen <- smelted_data %>% select(-c(Kingdom, Phylum, Class, Order, Family)) %>%
spread(Genus, Abundance) %>%
group_by(Sample) %>% select(-c(Clostridium)) %>%
summarize(across(2:94, ~unique(na.omit(.x))),.groups = 'drop')
abundances_gen
# Save results as data frame
tax_alpha_cor <- as.data.frame(cor(abundances_gen[, c(7:16)], abundances_gen[,c(17:94)]))
tax_alpha_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_tax_alpha_1 <- cor(abundances_gen[, c(7:16)], abundances_gen[,c(17:55)] , method = "spearman")
corrplot(matrix_tax_alpha_1, method="circle", tl.col = "black", tl.srt = 90, tl.cex =0.9, col.lim = c(-1,1), is.corr = FALSE)
matrix_tax_alpha_2 <- cor(abundances_gen[, c(7:16)], abundances_gen[,c(56:94)] , method = "spearman")
corrplot(matrix_tax_alpha_2, method="circle", tl.col = "black", tl.srt = 90, tl.cex =0.9, col.lim = c(-1,1), is.corr = FALSE)
# Save results as data frame
tax_SCFA_cor <- as.data.frame(cor(abundances_gen[, c(4:6)], abundances_gen[,c(17:94)]))
tax_SCFA_cor %>% tibble::rownames_to_column() %>% flextable()
# Plot correlation
matrix_tax_SCFA_1 <- cor(abundances_gen[, c(4:6)], abundances_gen[,c(17:55)] , method = "spearman")
corrplot(matrix_tax_SCFA_1, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", is.corr = FALSE)
colorlegend(xlim=c(-3,0), ylim=c(10,5), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
matrix_tax_SCFA_2 <- cor(abundances_gen[, c(4:6)], abundances_gen[,c(56:94)] , method = "spearman")
corrplot(matrix_tax_SCFA_2, method="circle", tl.col = "black", tl.srt = 90, cl.pos="n", is.corr = FALSE)
colorlegend(xlim=c(-3,0), ylim=c(10,5), scalebluered, c(seq(-1,1,1)), align="r", vertical=TRUE, addlabels=TRUE)
matrix_all_1 <- cor(abundances_gen[, c(4:16)], abundances_gen[,c(17:55)] , method = "spearman")
corrplot(matrix_all_1, method="circle", tl.col = "black", tl.srt = 90, tl.cex =0.9, col.lim = c(-1,1), is.corr = FALSE)
matrix_all_2 <- cor(abundances_gen[, c(4:16)], abundances_gen[,c(56:94)] , method = "spearman")
corrplot(matrix_all_2, method="circle", tl.col = "black", tl.srt = 90, tl.cex =0.9, col.lim = c(-1,1), is.corr = FALSE)
